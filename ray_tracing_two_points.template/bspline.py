##############################################################################
# need python 3.*  (I guess)
# small library of bspline functions
##############################################################################
import sys
import numpy as np

##############################################################################
#
# bsp2ts(s,t,p)
#
##############################################################################
def bsp2ts(s,t,p):
  p1=0.5*(-1.+s*( 2.-1.*s))
  p2=0.5*(   +s*(-4.+3.*s))
  p3=0.5*( 1.+s*( 2.-3.*s))
  p4=0.5*     s*        s
  q1=p[0][0]*p1+p[0][1]*p2+p[0][2]*p3+p[0][3]*p4
  q2=p[1][0]*p1+p[1][1]*p2+p[1][2]*p3+p[1][3]*p4
  q3=p[2][0]*p1+p[2][1]*p2+p[2][2]*p3+p[2][3]*p4
  q4=p[3][0]*p1+p[3][1]*p2+p[3][2]*p3+p[3][3]*p4
  return bsp1x1(t,q1,q2,q3,q4)

##############################################################################
#
# bsp2st(s,t,p)
#
##############################################################################
def bsp2st(s,t,p):
  q1=0.5*(-1.+t*( 2.-1.*t))
  q2=0.5*(   +t*(-4.+3.*t))
  q3=0.5*( 1.+t*( 2.-3.*t))
  q4=0.5*     t*        t
  p1=p[0][0]*q1+p[0][1]*q2+p[0][2]*q3+p[0][3]*q4
  p2=p[1][0]*q1+p[1][1]*q2+p[1][2]*q3+p[1][3]*q4
  p3=p[2][0]*q1+p[2][1]*q2+p[2][2]*q3+p[2][3]*q4
  p4=p[3][0]*q1+p[3][1]*q2+p[3][2]*q3+p[3][3]*q4
  return bsp1x1(s,p1,p2,p3,p4)

##############################################################################
#
# bsp2t2(s,t,p)
#
##############################################################################
def bsp2t2(s,t,p):
  q1= 1.-   t
  q2=-2.+3.*t
  q3= 1.-3.*t
  q4=       t
  p1=p[0][0]*q1+p[0][1]*q2+p[0][2]*q3+p[0][3]*q4
  p2=p[1][0]*q1+p[1][1]*q2+p[1][2]*q3+p[1][3]*q4
  p3=p[2][0]*q1+p[2][1]*q2+p[2][2]*q3+p[2][3]*q4
  p4=p[3][0]*q1+p[3][1]*q2+p[3][2]*q3+p[3][3]*q4
  return bsp1(s,p1,p2,p3,p4)

##############################################################################
#
# bsp2t1(s,t,p)
#
##############################################################################
def bsp2t1(s,t,p):
  q1=0.5*(-1.+t*( 2.-1.*t))
  q2=0.5*(   +t*(-4.+3.*t))
  q3=0.5*( 1.+t*( 2.-3.*t))
  q4=0.5*     t*        t
  p1=p[0][0]*q1+p[0][1]*q2+p[0][2]*q3+p[0][3]*q4
  p2=p[1][0]*q1+p[1][1]*q2+p[1][2]*q3+p[1][3]*q4
  p3=p[2][0]*q1+p[2][1]*q2+p[2][2]*q3+p[2][3]*q4
  p4=p[3][0]*q1+p[3][1]*q2+p[3][2]*q3+p[3][3]*q4
  return bsp1(s,p1,p2,p3,p4)

##############################################################################
#
# bsp2s2(s,t,p)
#
##############################################################################
def bsp2s2(s,t,p):
  q1=0.166666666667*(1.+t*(-3.+t*( 3.-    t)))
  q2=0.166666666667*(4.+t*     t*(-6.+3.*t))
  q3=0.166666666667*(1.+t*( 3.+t*( 3.-3.*t)))
  q4=0.166666666667*t*t*t
  p1=p[0][0]*q1+p[0][1]*q2+p[0][2]*q3+p[0][3]*q4
  p2=p[1][0]*q1+p[1][1]*q2+p[1][2]*q3+p[1][3]*q4
  p3=p[2][0]*q1+p[2][1]*q2+p[2][2]*q3+p[2][3]*q4
  p4=p[3][0]*q1+p[3][1]*q2+p[3][2]*q3+p[3][3]*q4
  return bsp1x2(s,p1,p2,p3,p4)

##############################################################################
#
# bsp2s1(s,t,p)
#
##############################################################################
def bsp2s1(s,t,p):
  q1=0.166666666667*(1.+t*(-3.+t*( 3.-    t)))
  q2=0.166666666667*(4.+t*     t*(-6.+3.*t))
  q3=0.166666666667*(1.+t*( 3.+t*( 3.-3.*t)))
  q4=0.166666666667*t*t*t
  p1=p[0][0]*q1+p[0][1]*q2+p[0][2]*q3+p[0][3]*q4
  p2=p[1][0]*q1+p[1][1]*q2+p[1][2]*q3+p[1][3]*q4
  p3=p[2][0]*q1+p[2][1]*q2+p[2][2]*q3+p[2][3]*q4
  p4=p[3][0]*q1+p[3][1]*q2+p[3][2]*q3+p[3][3]*q4
  return bsp1x1(s,p1,p2,p3,p4)

##############################################################################
#
# bsp2(s,t,p)
#
##############################################################################
def bsp2(s,t,p):
  q1=0.166666666667*(1.+t*(-3.+t*( 3.-    t)))
  q2=0.166666666667*(4.+t*     t*(-6.+3.*t))
  q3=0.166666666667*(1.+t*( 3.+t*( 3.-3.*t)))
  q4=0.166666666667*t*t*t
  p1=p[0][0]*q1+p[0][1]*q2+p[0][2]*q3+p[0][3]*q4
  p2=p[1][0]*q1+p[1][1]*q2+p[1][2]*q3+p[1][3]*q4
  p3=p[2][0]*q1+p[2][1]*q2+p[2][2]*q3+p[2][3]*q4
  p4=p[3][0]*q1+p[3][1]*q2+p[3][2]*q3+p[3][3]*q4
  value=bsp1(s,p1,p2,p3,p4)
  return value

##############################################################################
#
# bsp1(t,q1,q2,q3,q4)
#
##############################################################################
def bsp1(t,q1,q2,q3,q4):
  value=0.166666666667*(    q1+4.*q2+   q3+     \
                    t*(-3.*q1      +3.*q3+      \
                    t*( 3.*q1-6.*q2+3.*q3+      \
                    t*(   -q1+3.*q2-3.*q3+q4))))
  return value

##############################################################################
#
# bsp1x1(t,q1,q2,q3,q4)
#
##############################################################################
def bsp1x1(t,q1,q2,q3,q4):
  value=0.5*(  -q1      +   q3+       \
           t*(2.*q1-4.*q2+2.*q3+      \
           t*(  -q1+3.*q2-3.*q3+q4)))
  return value

##############################################################################
#
# bsp1x2(t,p)
#
##############################################################################
def bsp1x2(t,q1,q2,q3,q4):
  value=    q1-2.*q2+   q3+     \
         t*(-q1+3.*q2-3.*q3+q4)
  return value
